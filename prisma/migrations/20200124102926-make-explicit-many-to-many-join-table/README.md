# Migration `20200124102926-make-explicit-many-to-many-join-table`

This migration has been generated by Matt Condon (shrugs) at 1/24/2020, 10:29:26 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "songadayworld"."_collectors_AB_unique"

CREATE TABLE "songadayworld"."CollectedSong" (
    "collector" text  NOT NULL ,
    "id" text  NOT NULL ,
    "song" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

ALTER TABLE "songadayworld"."Song" DROP COLUMN "instrument",
ADD COLUMN "instrument" text  NOT NULL DEFAULT 'AcousticGuitar',
DROP COLUMN "location",
ADD COLUMN "location" text  NOT NULL DEFAULT 'Baltimore',
DROP COLUMN "mood",
ADD COLUMN "mood" text  NOT NULL DEFAULT 'Angry',
DROP COLUMN "topic",
ADD COLUMN "topic" text  NOT NULL DEFAULT 'Airport';

ALTER TABLE "songadayworld"."CollectedSong" ADD FOREIGN KEY ("song") REFERENCES "songadayworld"."Song"("id") ON DELETE RESTRICT

ALTER TABLE "songadayworld"."CollectedSong" ADD FOREIGN KEY ("collector") REFERENCES "songadayworld"."User"("id") ON DELETE RESTRICT

DROP TABLE "songadayworld"."_collectors";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200124102600-make-song-user-optional..20200124102926-make-explicit-many-to-many-join-table
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 generator photon {
   provider = "prisma-client-js"
@@ -112,24 +112,24 @@
   Vocals
 }
 model Song {
-  id          String     @default(cuid()) @id
-  number      Int        @unique
-  youtubeId   String     @unique
-  title       String
-  description String
-  collectors  User[]     @relation(name: "collectors")
-  owner       User?      @relation(name: "owner")
-  location    Location
-  topic       Topic
-  mood        Mood
-  beard       Beard
-  instrument  Instrument
-  comments    Comment[]
-  releasedAt  DateTime   @default(now())
-  createdAt   DateTime   @default(now())
-  updatedAt   DateTime   @updatedAt
+  id             String          @default(cuid()) @id
+  number         Int             @unique
+  youtubeId      String          @unique
+  title          String
+  description    String
+  collectedSongs CollectedSong[]
+  owner          User?
+  location       Location
+  topic          Topic
+  mood           Mood
+  beard          Beard
+  instrument     Instrument
+  comments       Comment[]
+  releasedAt     DateTime        @default(now())
+  createdAt      DateTime        @default(now())
+  updatedAt      DateTime        @updatedAt
 }
 model MagicCode {
   code      String   @id
@@ -137,14 +137,14 @@
   createdAt DateTime @default(now())
 }
 model User {
-  id             String     @default(cuid()) @id
-  email          String     @unique
+  id             String          @default(cuid()) @id
+  email          String          @unique
   displayName    String?
   magicCode      MagicCode?
-  collectedSongs Song[]     @relation(name: "collectors")
-  ownedSongs     Song[]     @relation(name: "owner")
+  collectedSongs CollectedSong[]
+  ownedSongs     Song[]
 }
 model Comment {
   id        String   @default(cuid()) @id
@@ -163,4 +163,10 @@
   text      String
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
+
+model CollectedSong {
+  id        String @default(cuid()) @id
+  song      Song
+  collector User
+}
```


