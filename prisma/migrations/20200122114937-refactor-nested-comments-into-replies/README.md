# Migration `20200122114937-refactor-nested-comments-into-replies`

This migration has been generated by Matt Condon (shrugs) at 1/22/2020, 11:49:37 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "songadayworld"."Reply" (
    "author" text  NOT NULL ,
    "comment" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "text" text  NOT NULL DEFAULT '',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

ALTER TABLE "songadayworld"."Comment" DROP COLUMN "comment";

ALTER TABLE "songadayworld"."Reply" ADD FOREIGN KEY ("author") REFERENCES "songadayworld"."User"("id") ON DELETE RESTRICT

ALTER TABLE "songadayworld"."Reply" ADD FOREIGN KEY ("comment") REFERENCES "songadayworld"."Comment"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200121102932-next-comments-instead-of-referencing..20200122114937-refactor-nested-comments-into-replies
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRES_URL")
 }
 generator photon {
   provider = "prisma-client-js"
@@ -108,12 +108,21 @@
   song        Song?
 }
 model Comment {
-  id        String    @default(cuid()) @id
+  id        String   @default(cuid()) @id
   song      Song
-  comments  Comment[]
+  replies   Reply[]
   author    User
   text      String
-  createdAt DateTime  @default(now())
-  updatedAt DateTime  @updatedAt
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
 }
+
+model Reply {
+  id        String   @default(cuid()) @id
+  comment   Comment
+  author    User
+  text      String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```


