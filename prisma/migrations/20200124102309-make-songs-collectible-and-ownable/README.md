# Migration `20200124102309-make-songs-collectible-and-ownable`

This migration has been generated by Matt Condon (shrugs) at 1/24/2020, 10:23:09 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "songadayworld"."Song_owner"

CREATE TABLE "songadayworld"."_collectors" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

ALTER TABLE "songadayworld"."Song" DROP COLUMN "instrument",
ADD COLUMN "instrument" text  NOT NULL DEFAULT 'AcousticGuitar',
DROP COLUMN "location",
ADD COLUMN "location" text  NOT NULL DEFAULT 'Baltimore',
DROP COLUMN "mood",
ADD COLUMN "mood" text  NOT NULL DEFAULT 'Angry',
DROP COLUMN "owner",
ADD COLUMN "owner" text  NOT NULL ,
DROP COLUMN "topic",
ADD COLUMN "topic" text  NOT NULL DEFAULT 'Airport';

CREATE UNIQUE INDEX "_collectors_AB_unique" ON "songadayworld"."_collectors"("A","B")

ALTER TABLE "songadayworld"."_collectors" ADD FOREIGN KEY ("A") REFERENCES "songadayworld"."Song"("id") ON DELETE CASCADE

ALTER TABLE "songadayworld"."_collectors" ADD FOREIGN KEY ("B") REFERENCES "songadayworld"."User"("id") ON DELETE CASCADE

ALTER TABLE "songadayworld"."Song" ADD FOREIGN KEY ("owner") REFERENCES "songadayworld"."User"("id") ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200122132432-update-enum-options..20200124102309-make-songs-collectible-and-ownable
--- datamodel.dml
+++ datamodel.dml
@@ -1,14 +1,13 @@
 datasource db {
   provider = "postgresql"
-  url      = "***"
+  url      = env("POSTGRES_URL")
 }
 generator photon {
   provider = "prisma-client-js"
 }
-// via https://docs.google.com/spreadsheets/d/18jj0J-IiKvwdnhligRVQR_7dpxLKIIvDh9B4bCwtEM0/edit#gid=0
 enum Location {
   Baltimore
   Berkeley
   JupiterFL
@@ -118,9 +117,10 @@
   number      Int        @unique
   youtubeId   String     @unique
   title       String
   description String
-  owner       User?
+  collectors  User[]     @relation(name: "collectors")
+  owner       User       @relation(name: "owner")
   location    Location
   topic       Topic
   mood        Mood
   beard       Beard
@@ -137,13 +137,14 @@
   createdAt DateTime @default(now())
 }
 model User {
-  id          String     @default(cuid()) @id
-  email       String     @unique
-  displayName String?
-  magicCode   MagicCode?
-  song        Song?
+  id             String     @default(cuid()) @id
+  email          String     @unique
+  displayName    String?
+  magicCode      MagicCode?
+  collectedSongs Song[]     @relation(name: "collectors")
+  ownedSongs     Song[]     @relation(name: "owner")
 }
 model Comment {
   id        String   @default(cuid()) @id
```


