# Migration `20200119105604-initial`

This migration has been generated by Matt Condon (shrugs) at 1/19/2020, 10:56:04 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "songadayworld"."Song" (
    "beard" text  NOT NULL DEFAULT 'Beard',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "description" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "instrument" text  NOT NULL DEFAULT 'Organ',
    "location" text  NOT NULL DEFAULT 'Vermont',
    "mood" text  NOT NULL DEFAULT 'Pensive',
    "number" integer  NOT NULL DEFAULT 0,
    "owner" text   ,
    "releasedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "thread" text  NOT NULL ,
    "title" text  NOT NULL DEFAULT '',
    "topic" text  NOT NULL DEFAULT 'Poetic',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "youtubeId" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "songadayworld"."MagicCode" (
    "code" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "user" text  NOT NULL ,
    PRIMARY KEY ("code")
) 

CREATE TABLE "songadayworld"."User" (
    "displayName" text   ,
    "email" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "songadayworld"."Thread" (
    "id" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "songadayworld"."Comment" (
    "author" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "replyTo" text   ,
    "text" text  NOT NULL DEFAULT '',
    "thread" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "Song.number" ON "songadayworld"."Song"("number")

CREATE UNIQUE INDEX "Song.youtubeId" ON "songadayworld"."Song"("youtubeId")

CREATE UNIQUE INDEX "Song_owner" ON "songadayworld"."Song"("owner")

CREATE UNIQUE INDEX "Song_thread" ON "songadayworld"."Song"("thread")

CREATE UNIQUE INDEX "MagicCode_user" ON "songadayworld"."MagicCode"("user")

CREATE UNIQUE INDEX "User.email" ON "songadayworld"."User"("email")

ALTER TABLE "songadayworld"."Song" ADD FOREIGN KEY ("owner") REFERENCES "songadayworld"."User"("id") ON DELETE SET NULL

ALTER TABLE "songadayworld"."Song" ADD FOREIGN KEY ("thread") REFERENCES "songadayworld"."Thread"("id") ON DELETE RESTRICT

ALTER TABLE "songadayworld"."MagicCode" ADD FOREIGN KEY ("user") REFERENCES "songadayworld"."User"("id") ON DELETE RESTRICT

ALTER TABLE "songadayworld"."Comment" ADD FOREIGN KEY ("author") REFERENCES "songadayworld"."User"("id") ON DELETE RESTRICT

ALTER TABLE "songadayworld"."Comment" ADD FOREIGN KEY ("thread") REFERENCES "songadayworld"."Thread"("id") ON DELETE RESTRICT

ALTER TABLE "songadayworld"."Comment" ADD FOREIGN KEY ("replyTo") REFERENCES "songadayworld"."Comment"("id") ON DELETE SET NULL
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200119105604-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,125 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRES_URL")
+}
+
+generator photon {
+  provider = "prisma-client-js"
+}
+
+// via https://docs.google.com/spreadsheets/d/18jj0J-IiKvwdnhligRVQR_7dpxLKIIvDh9B4bCwtEM0/edit#gid=0
+enum Location {
+  Vermont
+  LosAngeles
+  Oakland
+}
+
+enum Topic {
+  Poetic
+  Anxiety
+  Airport
+  Life
+  VideoGames
+  Commission
+  Internet
+  SongADay
+  Science
+  SocialJustice
+  Sex
+  Politics
+  Apple
+  Friend
+  Sick
+  Love
+  Animals
+  Nerd
+  Book
+  PSA
+  Object
+  Kids
+  Instrumental
+  Birthday
+  Ringtone
+  Contest
+  TV
+  ThemeSong
+  Motivational
+  Family
+  WanderingFall
+  Traditional
+  Improv
+}
+
+enum Mood {
+  Pensive
+  Sad
+  Anxious
+  Chill
+  Happy
+  Silly
+  Drunk
+  Intense
+  Tired
+  Excited
+  Angry
+  Confused
+  Bored
+  Disgusted
+}
+
+enum Beard {
+  Beard
+  None
+}
+
+enum Instrument {
+  Organ
+}
+
+model Song {
+  id          String     @default(cuid()) @id
+  number      Int        @unique
+  youtubeId   String     @unique
+  title       String
+  description String
+  owner       User?
+  location    Location
+  topic       Topic
+  mood        Mood
+  beard       Beard
+  instrument  Instrument
+  thread      Thread
+  releasedAt  DateTime   @default(now())
+  createdAt   DateTime   @default(now())
+  updatedAt   DateTime   @updatedAt
+}
+
+model MagicCode {
+  code      String   @id
+  user      User
+  createdAt DateTime @default(now())
+}
+
+model User {
+  id          String     @default(cuid()) @id
+  email       String     @unique
+  displayName String?
+  magicCode   MagicCode?
+  song        Song?
+}
+
+model Thread {
+  id       String    @default(cuid()) @id
+  song     Song
+  comments Comment[]
+}
+
+model Comment {
+  id        String   @default(cuid()) @id
+  thread    Thread
+  author    User
+  text      String
+  replyTo   Comment?
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```


